# CoTURN Configuration for The HIVE Translation System
# ULTRA-LOW LATENCY OPTIMIZATION for <500ms end-to-end translation
# Target: p95 NAT traversal ≤ 50ms, connection establishment ≤ 3s

# Listening ports - optimized for fastest UDP establishment
listening-port=3478
tls-listening-port=5349

# Extended port range for better connectivity and reduced port conflicts
min-port=49152
max-port=65535

# AGGRESSIVE UDP-FIRST POLICY - eliminate TCP overhead
no-tcp-relay
udp-self-balance
# Disable TCP entirely for lowest latency
no-tcp
# Force UDP relays
force-udp

# Server identity and realm
server-name=turn.thehive.app
realm=thehive

# Authentication - long-term credentials for production
lt-cred-mech

# Production user database (replace with secure credentials)
user=hiveuser:hivepass
user=translator:translatorpass

# Dynamic auth secret for scaling (production recommended)
# use-auth-secret
# static-auth-secret=your-secret-key

# Network interface binding
# listening-ip=10.0.0.1      # Bind to specific interface
# relay-ip=10.0.0.1          # Internal relay IP
# external-ip=203.0.113.1    # Public NAT IP

# ULTRA-LOW LATENCY TIMEOUTS - aggressive for real-time performance
channel-lifetime=300         # Reduced from 600s for faster cleanup
permission-lifetime=120      # Reduced from 300s for quicker refresh
stale-nonce=300             # Reduced from 600s for security/performance balance

# CONNECTION ESTABLISHMENT OPTIMIZATION
max-allocate-lifetime=1800   # Reduced from 3600s for tighter resource control
max-allocate-timeout=30      # Reduced from 60s for faster connection failures

# PERFORMANCE-OPTIMIZED CONNECTION LIMITS
max-allocate-session-lifetime=21600  # 6 hours (reduced from 24h)
total-quota=200                      # Increased for translation workload
user-quota=100                       # Increased per-user quota
max-relay-sessions=150               # Higher concurrent sessions

# BANDWIDTH OPTIMIZATION - prioritize latency over bandwidth efficiency
bps-capacity=0                       # Unlimited for lowest latency
# Alternative: bps-capacity=2000000  # 2 Mbps if bandwidth limiting needed

# NETWORK-SPECIFIC OPTIMIZATIONS
# Enable for production deployment
no-loopback-peers                    # Security + performance
no-multicast-peers                   # Avoid multicast overhead
denied-peer-ip=0.0.0.0-0.255.255.255     # Block localhost ranges
denied-peer-ip=10.0.0.0-10.255.255.255   # Block private ranges
denied-peer-ip=172.16.0.0-172.31.255.255 # Block private ranges  
denied-peer-ip=192.168.0.0-192.168.255.255 # Block private ranges

# LOGGING - minimal for production performance
log-file=/var/log/coturn/turnserver.log
simple-log
# Remove verbose logging for performance
# verbose

# SECURITY HARDENING - production ready
fingerprint                         # Enable STUN fingerprinting
lt-cred-mech                        # Long-term credential mechanism
secure-stun                         # Enable secure STUN

# TLS/DTLS OPTIMIZATION - prefer performance over maximum security
tls-cert-file=/etc/coturn/cert.pem
tls-private-key-file=/etc/coturn/private.key

# OPTIMIZED CIPHER SUITES - balance security and performance
cipher-list="ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384"

# DH parameters for performance (2048-bit balance)
dh-file=/etc/coturn/dhparam.pem

# REDIS INTEGRATION for high-performance clustering
redis-userdb="host=redis dbname=0 password= port=6379 connect_timeout=5"
redis-statsdb="host=redis dbname=1 password= port=6379 connect_timeout=5"

# PROCESS OPTIMIZATION - production deployment
pidfile=/var/run/turnserver.pid
daemon                              # Run as daemon
proc-user=turnserver               # Security isolation
proc-group=turnserver              # Security isolation

# NETWORK MOBILITY SUPPORT - for mobile clients
mobility                           # Support connection migration

# PERFORMANCE MONITORING - lightweight stats
stats-interval=30                  # More frequent stats for monitoring
log-bandwidth                      # Track bandwidth for optimization

# ADMINISTRATION - secure web interface
no-cli                            # Disable CLI for security
web-admin                         # Enable web admin interface
web-admin-port=8080               # Admin interface port  
web-admin-ip=127.0.0.1           # Restrict to localhost

# ADVANCED NETWORK OPTIMIZATIONS
# OS-level socket optimizations
so-reuseaddr                      # Allow socket reuse
so-no-delay                       # Disable Nagle's algorithm for low latency
so-keepalive                      # Enable keepalive packets

# UDP OPTIMIZATION for real-time audio
udp-recv-buffer-size=1048576      # 1MB receive buffer
udp-send-buffer-size=1048576      # 1MB send buffer

# CONNECTION POOLING for efficiency
max-allocate-per-username=20      # Allow multiple allocations per user
max-allocate-per-ip=50           # Higher allocation per IP